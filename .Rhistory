format(Sys.Date(), "%Y-%m-%d")
format(Sys.Date(), "%d-%m-%Y")
sigma <- matrix(c(1, 0.5, 0.5, 1), nrow = 2)
x <- seq(-5, 5, 0.25)
y <- seq(-5, 5, 0.25)
mu <- c(0, 0)
sigma <- matrix(c(1, 0.5, 0.5, 1), nrow = 2)
install.packages("magick")
magick::image_read("../../figs/me_cake.jpg") |>
magick::image_crop("200x200+0+200")
magick::image_read("../../figs/me_cake.jpg") |>
magick::image_crop("1000x1000+0+200")
magick::image_read("../../figs/me_cake.jpg") |>
magick::image_crop("1000x1000+0+100")
magick::image_read("../../figs/me_cake.jpg") |>
magick::image_crop("1000x1000+0+100") |>
print()
magick::image_read("../../figs/me_cake.jpg") |>
magick::image_crop("1000x1500+0+100") |>
print()
magick::image_read("../../figs/me_cake.jpg") |>
magick::image_crop("1500x1500+0+100") |>
print()
magick::image_read("../../figs/me_cake.jpg") |>
magick::image_crop("1500x1400+0+120") |>
print()
magick::image_read("../../figs/me_cake.jpg") |>
magick::image_crop("1600x1400+0+120") |>
print()
magick::image_read("../../figs/me_cake.jpg") |>
magick::image_crop("1600x1400+0+150") |>
print()
cranlogs::cran_downloads("densityratio")
cranlogs::cran_downloads("densityratio", "last-week")
cranlogs::cran_downloads("densratio", "last-week")
magick::image_read("../../figs/me_cake.jpg") |>
magick::image_crop("1600x1400+0+150") |>
as.raster() |>
plot()
magick::image_read("../../figs/me_cake.jpg") |>
magick::image_crop("1600x1400+0+150") |>
magick::image_write("../../figs/me_cake_cropped.jpg")
?image_crop
magick::image_read("../../figs/me_cake.jpg") |>
magick::image_crop("1600x1400+0+150") |>
magick::image_draw()
magick::image_crop(
img,
geometry = paste0(
min(img$width, img$height), "x", min(img$width, img$height),, "+0+0"
),
repage = TRUE
)
img <- magick::image_read("../../figs/me_cake.jpg") |>
magick::image_crop("1600x1400+0+150")
magick::image_crop(
img,
geometry = paste0(
min(img$width, img$height), "x", min(img$width, img$height),, "+0+0"
),
repage = TRUE
)
?image_crop
im <- magick::image_crop(
img,
geometry = paste0(
min(img$width, img$height), "x", min(img$width, img$height),, "+0+0"
),
repage = TRUE
)
invisible(img)
magick::image_read("../../figs/me_cake.jpg") |>
magick::image_crop("1600x1400+0+150") |>
magick::image_write("../../figs/me_cake_cropped.jpg")
cranlogs::cran_downloads("densityratio")
cranlogs::cran_downloads("densityratio", "last-month")
cranlogs::cran_downloads("densityratio", "last-month")
cranlogs::cran_downloads("densityratio", "last-month")
cranlogs::cran_downloads("densityratio", "last-month")
cranlogs::cran_downloads("densityratio", "last-month")
cranlogs::cran_downloads("densityratio", "last-month")
cranlogs::cran_downloads("densityratio", "last-month")
cranlogs::cran_downloads("densityratio", "last-month")
cranlogs::cran_downloads("densityratio", "last-month")
cranlogs::cran_downloads("densityratio", "last-month") |>
{\(x) sum(x$count)}()
cranlogs::cran_downloads("densityratio", "last-month") |>
{\(x) sum(x$count)}()
cranlogs::cran_downloads("densityratio", "last-month") |>
{\(x) sum(x$count)}()
tensorflow::install_tensorflow()
tensorflow::install_tensorflow()
remotes::install_github("rstudio/tensorflow")
reticulate::install_python()
install.packages("keras")
keras::install_keras()
keras::install_keras(method = "conda")
reticulate::install_python()
install.packages("reticulate")
reticulate::install_python()
#| label: fig-normal-density
#| fig-cap: "Distribution of the true data-generating mechanism (black line) and the estimated density of the training data (orange line)."
library(keras3)
set.seed(123)
set_random_seed(123)
#| label: fig-normal-density
#| fig-cap: "Distribution of the true data-generating mechanism (black line) and the estimated density of the training data (orange line)."
library(keras3)
set.seed(123)
set_random_seed(123)
#| echo: false
#| label: fig-gan
#| fig-cap: "Graphical representation of a GAN."
# create graph for GAN with graphviz
DiagrammeR::grViz("digraph {
graph [layour = dot, rankdir = LR]
node [shape = rectangle, style = filled, fillcolor = lightblue]
N1 [label = 'Random noise']
N2 [label = 'Generator']
N3 [label = 'Synthetic data']
N4 [label = 'Discriminator']
N1 -> N2 -> N3 -> N4 -> N2
}")
set.seed(123)
set_random_seed(123)
N <- 1000
train_dat <- matrix(rnorm(N, 2, 4))
plot(density(train_dat), col = "darkorange2")
curve(dnorm(x, 2, 4), add = TRUE)
#| label: single-layer-gan
generator <- function(latent_dim = 1) {
model <- keras_model_sequential(input_shape = latent_dim, name = "seq_gen") |>
layer_dense(units = 1, activation = "linear")
}
summary(generator())
#| label: one-hidden-layer-discriminator
discriminator <- function(dim = 1) {
model <- keras_model_sequential(input_shape = dim, name = "seq_disc") |>
layer_dense(units = 8, activation = "relu") |>
layer_dense(units = 1, activation = "sigmoid")
}
summary(discriminator())
#| label: gan-model-class
gan <- new_model_class(
classname = "GAN",
# initialize model with generator, discriminator, dimension
# of the random latent vectors (i.e., the input that is
# transformed by the generator to yield useful synthetic
# data).
initialize = function(discriminator, generator, latent_dim) {
super$initialize()
self$discriminator <- discriminator
self$generator <- generator
self$latent_dim <- latent_dim
self$d_loss_metric <- metric_mean(name = "d_loss")
self$g_loss_metric <- metric_mean(name = "g_loss")
},
# create compile function that sets the optimizers and loss
compile = function(d_optimizer, g_optimizer, loss_fn) {
super$compile()
self$d_optimizer <- d_optimizer
self$g_optimizer <- g_optimizer
self$loss_fn <- loss_fn
},
# plot generator and discriminator loss during training
metrics = mark_active(function() {
list(self$d_loss_metric, self$g_loss_metric)
}),
# define the training step, set batch size, create random normal variates
# as input for the generator, stack real and generated data, create labels
# for the discriminator, add some noise to the labels to prevent overfitting,
# compute discriminator loss, compute gradients, apply gradients to the
# discriminator.
train_step = function(real_data) {
batch_size <- tf$shape(real_data)[1]
random_latent_vectors <- tf$random$normal(shape = c(batch_size, self$latent_dim))
generated_data <- self$generator(random_latent_vectors)
combined_data <- tf$concat(list(generated_data, real_data), axis = 0L)
labels <- tf$concat(list(tf$ones(tuple(batch_size, 1L)),
tf$zeros(tuple(batch_size, 1L))), axis = 0L)
labels <- labels + tf$random$uniform(tf$shape(labels), maxval = 0.01)
with(tf$GradientTape() %as% tape, {
predictions <- self$discriminator(combined_data)
d_loss <- self$loss_fn(labels, predictions)
})
grads <- tape$gradient(d_loss, self$discriminator$trainable_weights)
self$d_optimizer$apply_gradients(
zip_lists(grads, self$discriminator$trainable_weights)
)
# Then sample new random points in latent space, and create labels as if all
# these new samples were real so that only the generator is trained, and not
# the discriminator. Then the generator loss is computed, and the generator
# weights are updated.
random_latent_vectors <- tf$random$normal(shape = c(batch_size, self$latent_dim))
misleading_labels <- tf$zeros(tuple(batch_size, 1L))
with(tf$GradientTape() %as% tape, {
predictions <- random_latent_vectors |>
self$generator() |>
self$discriminator()
g_loss <- self$loss_fn(misleading_labels, predictions)
})
grads <- tape$gradient(g_loss, self$generator$trainable_weights)
self$g_optimizer$apply_gradients(
zip_lists(grads, self$generator$trainable_weights)
)
self$d_loss_metric$update_state(d_loss)
self$g_loss_metric$update_state(g_loss)
list(d_loss = self$d_loss_metric$result(),
g_loss = self$g_loss_metric$result())
}
)
latent_dim <- as.integer(1)
nsyn <- nrow(train_dat)
mod <- gan(
discriminator = discriminator(dim = ncol(train_dat)),
generator = generator(latent_dim = latent_dim),
latent_dim = latent_dim
)
mod |>
compile(
d_optimizer = optimizer_adam(beta_1 = 0.5),
g_optimizer = optimizer_adam(beta_1 = 0.5),
loss_fn = loss_binary_crossentropy()
)
plot(
density(train_dat),
ylim = c(0, 0.2),
xlim = c(-12, 16),
col = "darkorange2",
xlab = "x",
main = "GAN Training"
)
curve(dnorm(x, 2, 4), add = TRUE)
curve(dnorm(x, 0, 1), add = TRUE, col = "black", lty=2)
for (i in 1:5) {
mod |>
fit(train_dat, epochs = 30, batch_size = 32, verbose = 0)
newdat <- mod$generator(tf$random$normal(shape = c(nsyn, latent_dim)))
lines(density(as.matrix(newdat)),
col = RColorBrewer::brewer.pal(7, "Greens")[i])
}
#| echo: false
#| label: fig-gan
#| fig-cap: "Graphical representation of a GAN."
# create graph for GAN with graphviz
DiagrammeR::grViz("digraph {
graph [layour = dot, rankdir = LR, fillcolor = '#fffbf2']
node [shape = rectangle, style = filled, fillcolor = lightblue]
N1 [label = 'Random noise']
N2 [label = 'Generator']
N3 [label = 'Synthetic data']
N4 [label = 'Discriminator']
N1 -> N2 -> N3 -> N4 -> N2
}")
DiagrammeR::grViz("digraph {
graph [layour = dot, rankdir = LR, bgcolor = '#fffbf2']
node [shape = rectangle, style = filled, fillcolor = lightblue]
N1 [label = 'Random noise']
N2 [label = 'Generator']
N3 [label = 'Synthetic data']
N4 [label = 'Discriminator']
N1 -> N2 -> N3 -> N4 -> N2
}")
install.packages("thematic")
X <- rnorm(200) |> matrix(100) %*% chol(0.5 + 0.5 * diag(2))
mahalanobis(X)
mahalanobis(X, center = c(0,0))
mahalanobis(X, center = c(0,0), cov = diag(2))
X %*% chol(diag(2))
D^2 <- mahalanobis(X, center = c(0,0), cov = diag(2))
D2 <- mahalanobis(X, center = c(0,0), cov = diag(2))
hist(D2)
hist(D2, breaks = 50)
hist(D2, breaks = 20)
X <- rnorm(200) |> matrix(100) %*% chol(0.5 + 0.5 * diag(2))
D2 <- mahalanobis(X, center = c(0,0), cov = diag(2))
hist(D2, breaks = 20)
X <- rnorm(200) |> matrix(100) %*% chol(0.5 + 0.5 * diag(2))
D2 <- mahalanobis(X, center = c(0,0), cov = diag(2))
hist(D2, breaks = 20, freq = FALSE)
curve(dchisq(x, df = 2))
X <- rnorm(200) |> matrix(100) %*% chol(0.5 + 0.5 * diag(2))
D2 <- mahalanobis(X, center = c(0,0), cov = diag(2))
hist(D2, breaks = 20, freq = FALSE)
curve(dchisq(x, df = 2), add = TRUE)
X <- rnorm(2000) |> matrix(100) %*% chol(0.5 + 0.5 * diag(2))
X <- rnorm(2000) |> matrix(100) %*% chol(0.5 + 0.5 * diag(20))
D2 <- mahalanobis(X, center = c(0,0), cov = diag(2))
N <- 100
P <- 20
X <- rnorm(N*P) |> matrix(N) %*% chol(0.5 + 0.5 * diag(P))
D2 <- mahalanobis(X, center = rep(0, P), cov = diag(P))
hist(D2, breaks = 20, freq = FALSE)
curve(dchisq(x, df = P), add = TRUE)
curve(dchisq(x, df = sqrt(P)), add = TRUE)
N <- 100
P <- 20
X <- rnorm(N*P) |> matrix(N) %*% chol(0.5 + 0.5 * diag(P))
D2 <- mahalanobis(X, center = rep(0, P), cov = diag(P))
hist(D2, breaks = 20, freq = FALSE)
curve(dchisq(x, df = sqrt(P)), add = TRUE)
D2 <- mahalanobis(X, center = rep(0, P), cov = 0.5 + 0.5*diag(P))
hist(D2, breaks = 20, freq = FALSE)
curve(dchisq(x, df = P, add = TRUE)
curve(dchisq(x, df = P), add = TRUE)
N <- 10000
P <- 20
X <- rnorm(N*P) |> matrix(N) %*% chol(0.5 + 0.5 * diag(P))
D2 <- mahalanobis(X, center = rep(0, P), cov = 0.5 + 0.5*diag(P))
hist(D2, breaks = 20, freq = FALSE)
curve(dchisq(x, df = P), add = TRUE)
N <- 10000
P <- 20
X <- rnorm(N*P) |> matrix(N) %*% chol(0.5 + 0.5 * diag(P))
D2 <- mahalanobis(X, center = rep(0, P), cov = diag(P))
hist(D2, breaks = 20, freq = FALSE)
curve(dchisq(x, df = P), add = TRUE)
N <- 10000
P <- 20
X <- rnorm(N*P) |> matrix(N) %*% chol(0.5 + 0.5 * diag(P))
D2 <- mahalanobis(X, center = colMeans(X), cov = var(X))
hist(D2, breaks = 20, freq = FALSE)
curve(dchisq(x, df = P), add = TRUE)
N <- 100000
P <- 20
X <- rnorm(N*P) |> matrix(N) %*% chol(0.5 + 0.5 * diag(P))
D2 <- mahalanobis(X, center = colMeans(X), cov = var(X))
hist(D2, breaks = 20, freq = FALSE)
curve(dchisq(x, df = P), add = TRUE)
hist(D2, breaks = 50, freq = FALSE)
curve(dchisq(x, df = P), add = TRUE)
plot(X)
N <- 1000
P <- 20
X <- rnorm(N*P) |> matrix(N) %*% chol(0.5 + 0.5 * diag(P))
D2 <- mahalanobis(X, center = colMeans(X), cov = var(X))
hist(D2, breaks = 50, freq = FALSE)
curve(dchisq(x, df = P), add = TRUE)
plot(X)
plot(data.frame(X))
N <- 1000
P <- 10
X <- rnorm(N*P) |> matrix(N) %*% chol(0.5 + 0.5 * diag(P))
D2 <- mahalanobis(X, center = colMeans(X), cov = var(X))
hist(D2, breaks = 50, freq = FALSE)
curve(dchisq(x, df = P), add = TRUE)
plot(data.frame(X))
P <- 5
X <- rnorm(N*P) |> matrix(N) %*% chol(0.5 + 0.5 * diag(P))
D2 <- mahalanobis(X, center = colMeans(X), cov = var(X))
hist(D2, breaks = 50, freq = FALSE)
curve(dchisq(x, df = P), add = TRUE)
plot(data.frame(X))
plot(X)
points(X + rnorm(N*P), col = "green")
plot(data.frame(X))
points(data.frame(X + rnorm(N*P)), col = "green")
points.default
plot(data.frame(X + rnorm(N*P)), col = "green", add = TRUE)
x <- numeric(100L)
x <- numeric(100L)
for (i in 2:100) x[i] <- x[i-1] + rnorm(1, 0, 0.2)
plot(x)
x <- numeric(1000L)
for (i in 2:1000) x[i] <- x[i-1] + rnorm(1, 0, 0.2)
plot(x)
L <- 100000
L <- 100000
x <- numeric(L)
for (i in 2:L) x[i] <- x[i-1] + rnorm(1, 0, 0.2)
plot(x)
L <- 1000000
x <- numeric(L)
for (i in 2:L) x[i] <- x[i-1] + rnorm(1, 0, 0.2)
plot(x)
cor(x, lag(x))
cor(x, lag(x, 1))
cor(x, lag(x, 2))
lag(x)
dplyr::lag(x)
cor(x, dplyr::lag(x))
cor(x, dplyr::lag(x), use = "complete.obs")
cor(x, dplyr::lag(x, 2), use = "complete.obs")
cor(x, dplyr::lag(x, 10), use = "complete.obs")
cor(x, dplyr::lag(x, 100), use = "complete.obs")
cor(x, dplyr::lag(x, 1000), use = "complete.obs")
cor(x, dplyr::lag(x, 10000), use = "complete.obs")
L <- 100
x <- numeric(L)
for (i in 2:L) x[i] <- x[i-1] + rnorm(1, 0, 0.2)
plot(x)
cor(x, dplyr::lag(x))
cor(x, dplyr::lag(x), use = "complete.obs")
L <- 10
x <- numeric(L)
for (i in 2:L) x[i] <- x[i-1] + rnorm(1, 0, 0.2)
cor(x, dplyr::lag(x), use = "complete.obs")
L <- 10
x <- numeric(L)
for (i in 2:L) x[i] <- x[i-1] + rnorm(1, 0, 0.2)
cor(x, dplyr::lag(x), use = "complete.obs")
L <- 10
x <- numeric(L)
for (i in 2:L) x[i] <- x[i-1] + rnorm(1, 0, 0.2)
cor(x, dplyr::lag(x), use = "complete.obs")
L <- 10
x <- numeric(L)
for (i in 2:L) x[i] <- x[i-1] + rnorm(1, 0, 0.2)
cor(x, dplyr::lag(x), use = "complete.obs")
L <- 10
x <- numeric(L)
for (i in 2:L) x[i] <- x[i-1] + rnorm(1, 0, 0.2)
cor(x, dplyr::lag(x), use = "complete.obs")
L <- 10
x <- numeric(L)
for (i in 2:L) x[i] <- x[i-1] + rnorm(1, 0, 0.2)
cor(x, dplyr::lag(x), use = "complete.obs")
L <- 10
x <- numeric(L)
for (i in 2:L) x[i] <- x[i-1] + rnorm(1, 0, 0.2)
cor(x, dplyr::lag(x), use = "complete.obs")
L <- 10
x <- numeric(L)
for (i in 2:L) x[i] <- x[i-1] + rnorm(1, 0, 0.2)
cor(x, dplyr::lag(x), use = "complete.obs")
L <- 10
x <- numeric(L)
for (i in 2:L) x[i] <- x[i-1] + rnorm(1, 0, 0.2)
cor(x, dplyr::lag(x), use = "complete.obs")
L <- 10
x <- numeric(L)
for (i in 2:L) x[i] <- x[i-1] + rnorm(1, 0, 0.2)
cor(x, dplyr::lag(x), use = "complete.obs")
L <- 10
x <- numeric(L)
for (i in 2:L) x[i] <- x[i-1] + rnorm(1, 0, 0.2)
cor(x, dplyr::lag(x), use = "complete.obs")
L <- 100
x <- numeric(L)
for (i in 2:L) x[i] <- x[i-1] + rnorm(1, 0, 0.2)
cor(x, dplyr::lag(x), use = "complete.obs")
L <- 100
x <- numeric(L)
for (i in 2:L) x[i] <- x[i-1] + rnorm(1, 0, 0.2)
cor(x, dplyr::lag(x), use = "complete.obs")
summary(lm(x ~ dplyr::lag(x, 1)))
N <- 1000
P <- 5
X <- rnorm(N*P) |> matrix(N) %*% chol(0.5 + 0.5 * diag(P))
D2 <- mahalanobis(X, center = colMeans(X), cov = var(X))
hist(D2, breaks = 50, freq = FALSE)
curve(dchisq(x, df = P), add = TRUE)
plot(data.frame(X))
plot(data.frame(X + rnorm(N*P)), col = "green", add = TRUE)
N <- 10000
P <- 5
X <- rnorm(N*P) |> matrix(N) %*% chol(0.5 + 0.5 * diag(P))
D2 <- mahalanobis(X, center = colMeans(X), cov = var(X))
hist(D2, breaks = 50, freq = FALSE)
curve(dchisq(x, df = P), add = TRUE)
par(mfrow = c(1,1))
N <- 10000
P <- 5
X <- rnorm(N*P) |> matrix(N) %*% chol(0.5 + 0.5 * diag(P))
D2 <- mahalanobis(X, center = colMeans(X), cov = var(X))
hist(D2, breaks = 50, freq = FALSE)
curve(dchisq(x, df = P), add = TRUE)
?mahalanobis(X, center = colMeans(X), cov = var(X))
